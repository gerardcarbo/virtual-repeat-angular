!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/platform-browser")):"function"==typeof define&&define.amd?define("virtual-repeat-angular-lib",["exports","@angular/core","rxjs","rxjs/operators","@angular/platform-browser"],e):e(t["virtual-repeat-angular-lib"]={},t.ng.core,t.rxjs,t.rxjs.operators,t.ng.platformBrowser)}(this,function(t,e,n,i,r){"use strict";var o=function(){function t(){this._holderHeight=0,this._containerWidth=0,this._containerHeight=0,this._subscription=new n.Subscription,this._scrollStateChange=new n.BehaviorSubject(s.IDLE),this._scrollPosition=new n.BehaviorSubject(0),this._sizeChange=new n.BehaviorSubject([0,0]),this.ignoreScrollEvent=!1,this._initialScrollTop=-1,this.currentScrollState=s.IDLE,this.rowHeight=100,this.scrollbarStyle="normal",this.scrollbarWidth=a()}return Object.defineProperty(t.prototype,"holderHeight",{get:function(){return this._holderHeight},set:function(t){var e=this;void 0!==t&&(this._holderHeight=t,0===this._holderHeight&&(this.listContainer.nativeElement.scrollTop=0),-1!==this._initialScrollTop&&0!==this._holderHeight&&setTimeout(function(){e.listContainer.nativeElement.scrollTop=e._initialScrollTop,e._initialScrollTop=-1}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"holderHeightInPx",{get:function(){return this.holderHeight?this.holderHeight+"px":"100%"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollStateChange",{get:function(){return this._scrollStateChange.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollPosition",{get:function(){return this._scrollPosition.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sizeChange",{get:function(){return this._sizeChange.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"newScrollPosition",{set:function(t){this.listContainer.nativeElement.scrollTop=t,this.holderHeight||(this._initialScrollTop=t),this._scrollPosition.next(t)},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var e=this;"hide-scrollbar"===this.scrollbarStyle&&(this.listContainer.nativeElement.style.right=0-this.scrollbarWidth+"px",this.listContainer.nativeElement.style.paddingRight=this.scrollbarWidth+"px"),window&&this._subscription.add(n.fromEvent(window,"resize").subscribe(function(){e.requestMeasure()})),this._subscription.add(n.fromEvent(this.listContainer.nativeElement,"scroll").pipe(i.filter(function(){return!e.ignoreScrollEvent||(e.ignoreScrollEvent=!1)}),i.map(function(){return e.listContainer.nativeElement.scrollTop})).subscribe(function(t){e._scrollPosition.next(t)})),this._subscription.add(this.scrollPosition.pipe(i.tap(function(){e.currentScrollState===s.IDLE&&(e.currentScrollState=s.SCROLLING,e._scrollStateChange.next(e.currentScrollState))}),i.debounceTime(200)).subscribe(function(){e.currentScrollState===s.SCROLLING&&(e.currentScrollState=s.IDLE,e._scrollStateChange.next(e.currentScrollState))})),setTimeout(function(){e.requestMeasure()})},t.prototype.ngOnDestroy=function(){this._subscription.unsubscribe()},t.prototype.measure=function(){if(this.listContainer&&this.listContainer.nativeElement){var t=this.listContainer.nativeElement.getBoundingClientRect();return this._containerWidth=t.width-this.scrollbarWidth,this._containerHeight=t.height,{width:this._containerWidth,height:this._containerHeight}}return{width:0,height:0}},t.prototype.requestMeasure=function(){var t=this.measure(),e=t.width,i=t.height;this._sizeChange.next([e,i])},t.decorators=[{type:e.Component,args:[{selector:"gc-virtual-repeat-container",template:'<div class="gc-virtual-repeat-container" #listContainer [ngClass]="scrollbarStyle">\n    <div class="gc-virtual-repeat-container" [style.height]="holderHeightInPx">\n        <ng-content></ng-content>\n    </div>\n</div>\n',styles:[".gc-virtual-repeat-container{overflow-y:auto;overflow-x:hidden;position:relative;contain:layout;-webkit-overflow-scrolling:touch}.gc-virtual-repeat-container .gc-virtual-repeat-container-holder{width:100%;position:relative}.gc-virtual-repeat-container.normal{width:100%;height:100%}.gc-virtual-repeat-container.hide-scrollbar{position:absolute;top:0;left:0;bottom:0;right:0}"]}]}],t.ctorParameters=function(){return[]},t.propDecorators={listContainer:[{type:e.ViewChild,args:["listContainer"]}],scrollPosition:[{type:e.Output}],rowHeight:[{type:e.Input}],newScrollPosition:[{type:e.Input}]},t}(),s={SCROLLING:0,IDLE:1};function a(){var t=document.createElement("p");t.style.width="100%",t.style.height="200px";var e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",e.style.width="200px",e.style.height="150px",e.style.overflow="hidden",e.appendChild(t),document.body.appendChild(e);var i=t.offsetWidth;e.style.overflow="scroll";var r=t.offsetWidth;return i==r&&(r=e.clientWidth),document.body.removeChild(e),i-r}s[s.SCROLLING]="SCROLLING",s[s.IDLE]="IDLE";var l=function(){function t(){this.limit=0,this._scrapViews=new Map}return t.prototype.getView=function(t){var e=this._scrapViews.get(t);return!e&&0<this._scrapViews.size&&(t=this._scrapViews.keys().next().value,e=this._scrapViews.get(t)),e&&this._scrapViews["delete"](t),e||null},t.prototype.recycleView=function(t,e){e.detach(),this._scrapViews.set(t,e)},t.prototype.pruneScrapViews=function(){if(!(this.limit<=1))for(var t,e=this._scrapViews.keys();this._scrapViews.size>this.limit;)t=e.next().value,this._scrapViews.get(t).destroy(),this._scrapViews["delete"](t)},t.prototype.setScrapViewsLimit=function(t){this.limit=t,this.pruneScrapViews()},t.prototype.clean=function(){this._scrapViews.forEach(function(t){t.destroy()}),this._scrapViews.clear()},t}(),c=function(){function t(t,e,i){this.$implicit=t,this.index=e,this.count=i}return Object.defineProperty(t.prototype,"first",{get:function(){return 0===this.index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"last",{get:function(){return this.index===this.count-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"even",{get:function(){return this.index%2==0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"odd",{get:function(){return!this.even},enumerable:!0,configurable:!0}),t}(),h=function(){function t(t,e,i,r){this._virtualRepeatContainer=t,this._differs=e,this._template=i,this._viewContainerRef=r,this._subscription=new n.Subscription,this._scrollY=0,this._invalidate=!0,this._isInLayout=!1,this._isInMeasure=!1,this._recycler=new l}return Object.defineProperty(t.prototype,"infiniteForTrackBy",{get:function(){return this._trackByFn},set:function(t){e.isDevMode()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn("trackBy must be a function, but received "+JSON.stringify(t)+". See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"infiniteForTemplate",{set:function(t){t&&(this._template=t)},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){if("virtualRepeatOf"in t){var e=t.virtualRepeatOf.currentValue;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this._trackByFn)}catch(i){throw new Error("Cannot find a differ supporting object '"+e+"' of type '"+u(e)+"'. NgFor only supports binding to Iterables such as Arrays.")}}},t.prototype.ngDoCheck=function(){if(this._differ){var t=this._differ.diff(this.virtualRepeatOf);t&&this.applyChanges(t)}},t.prototype.applyChanges=function(t){var r=this;this._collection||(this._collection=[]);var n=!1;t.forEachOperation(function(t,e,i){null==t.previousIndex?(n=!0,r._collection.splice(i,0,t.item)):null==i?(n=!0,r._collection.splice(e,1)):r._collection.splice(i,0,r._collection.splice(e,1)[0])}),t.forEachIdentityChange(function(t){r._collection[t.currentIndex]=t.item}),n&&this.requestMeasure(),this.requestLayout()},t.prototype.ngOnInit=function(){var n=this;this._subscription.add(this._virtualRepeatContainer.scrollPosition.pipe(i.filter(function(t){return Math.abs(t-n._scrollY)>=n._virtualRepeatContainer.rowHeight})).subscribe(function(t){n._scrollY=t,n.requestLayout()})),this._subscription.add(this._virtualRepeatContainer.sizeChange.subscribe(function(t){var e=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,o=i.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)s.push(r.value)}catch(a){n={error:a}}finally{try{r&&!r.done&&(i=o["return"])&&i.call(o)}finally{if(n)throw n.error}}return s}(t,2),i=e[0],r=e[1];n._containerWidth=i,n._containerHeight=r,n.requestMeasure()}))},t.prototype.ngOnDestroy=function(){this._subscription.unsubscribe(),this._recycler.clean()},t.prototype.requestMeasure=function(){var t=this;if(this._isInMeasure||this._isInLayout)return clearTimeout(this._pendingMeasurement),void(this._pendingMeasurement=window.setTimeout(function(){t.requestMeasure()},60));this.measure()},t.prototype.requestLayout=function(){!this._isInMeasure&&this._virtualRepeatContainer.rowHeight&&this.layout()},t.prototype.measure=function(){var t=this._collection&&0!==this._collection.length?this._collection.length:0;this._isInMeasure=!0,this._virtualRepeatContainer.holderHeight=this._virtualRepeatContainer.rowHeight*t,this.calculateScrapViewsLimit(),this._isInMeasure=!1,this._invalidate=!0,this.requestLayout()},t.prototype.layout=function(){if(!this._isInLayout){this._isInLayout=!0;var t=this._virtualRepeatContainer.measure(),e=t.width,i=t.height;if(this._containerWidth=e,this._containerHeight=i,!this._collection||0===this._collection.length){for(var r=0;r<this._viewContainerRef.length;r++){var n=this._viewContainerRef.get(r);this._viewContainerRef.detach(r),r--}return this._isInLayout=!1,void(this._invalidate=!1)}this.findPositionInRange();for(r=0;r<this._viewContainerRef.length;r++){n=this._viewContainerRef.get(r);this._viewContainerRef.detach(r),this._recycler.recycleView(n.context.index,n),r--}this.insertViews(),this._recycler.pruneScrapViews(),this._isInLayout=!1,this._invalidate=!1}},t.prototype.calculateScrapViewsLimit=function(){var t=this._containerHeight/this._virtualRepeatContainer.rowHeight+2;this._recycler.setScrapViewsLimit(t)},t.prototype.insertViews=function(){if(0<this._viewContainerRef.length){for(var t=this._viewContainerRef.get(0),e=this._viewContainerRef.get(this._viewContainerRef.length-1),i=t.context.index-1;i>=this._firstItemPosition;i--){var r=this.getView(i);this.dispatchLayout(i,r,!0)}for(i=e.context.index+1;i<=this._lastItemPosition;i++){r=this.getView(i);this.dispatchLayout(i,r,!1)}}else for(i=this._firstItemPosition;i<=this._lastItemPosition;i++){r=this.getView(i);this.dispatchLayout(i,r,!1)}},t.prototype.applyStyles=function(t,e){t.style.transform="translate3d(0, "+e+"px, 0)",t.style.webkitTransform="translate3d(0, "+e+"px, 0)",t.style.width=this._containerWidth+"px",t.style.height=this._virtualRepeatContainer.rowHeight+"px",t.style.position="absolute"},t.prototype.dispatchLayout=function(t,e,i){var r=t*this._virtualRepeatContainer.rowHeight;this.applyStyles(e.rootNodes[0],r),i?this._viewContainerRef.insert(e,0):this._viewContainerRef.insert(e),e.reattach()},t.prototype.findPositionInRange=function(){var t=this._scrollY,e=Math.floor(t/this._virtualRepeatContainer.rowHeight),i=t-e*this._virtualRepeatContainer.rowHeight,r=Math.ceil((this._containerHeight+i)/this._virtualRepeatContainer.rowHeight)+e;this._firstItemPosition=Math.max(e-1,0),this._lastItemPosition=Math.min(r+1,this._collection.length-1)},t.prototype.getView=function(t){var e=this._recycler.getView(t),i=this._collection[t],r=this._collection.length;return e?(e.context.$implicit=i,e.context.index=t,e.context.count=r):e=this._template.createEmbeddedView(new c(i,t,r)),e},t.decorators=[{type:e.Directive,args:[{selector:"[virtualRepeat][virtualRepeatOf]"}]}],t.ctorParameters=function(){return[{type:o},{type:e.IterableDiffers},{type:e.TemplateRef},{type:e.ViewContainerRef}]},t.propDecorators={virtualRepeatOf:[{type:e.Input}],infiniteForTrackBy:[{type:e.Input}],infiniteForTemplate:[{type:e.Input}]},t}();function u(t){return t.name||typeof t}var p=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[r.BrowserModule],declarations:[o,h],exports:[o,h]}]}],t}();t.SCROLL_STOP_TIME_THRESHOLD=200,t.VirtualRepeatContainer=o,t.SCROLL_STATE=s,t.getScrollBarWidth=a,t.Recycler=l,t.InfiniteRow=c,t.VirtualRepeat=h,t.getTypeNameForDebugging=u,t.VirtualRepeatAngularLibModule=p,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=virtual-repeat-angular-lib.umd.min.js.map