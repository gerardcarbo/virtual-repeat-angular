!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("virtual-repeat-angular-lib/virtual-repeat-container"),require("virtual-repeat-angular-lib/virtual-repeat.base"),require("@angular/platform-browser"),require("virtual-repeat-angular-lib/virtual-repeat-asynch")):"function"==typeof define&&define.amd?define("virtual-repeat-angular-lib",["exports","@angular/core","rxjs","rxjs/operators","virtual-repeat-angular-lib/virtual-repeat-container","virtual-repeat-angular-lib/virtual-repeat.base","@angular/platform-browser","virtual-repeat-angular-lib/virtual-repeat-asynch"],e):e(t["virtual-repeat-angular-lib"]={},t.ng.core,t.rxjs,t.rxjs.operators,null,null,t.ng.platformBrowser,null)}(this,function(t,e,i,o,r,a,n,s){"use strict";var l=function(){function t(){this._holderHeight=0,this._containerWidth=0,this._containerHeight=0,this._subscription=new i.Subscription,this._scrollStateChange=new i.BehaviorSubject(c.IDLE),this._scrollPosition=new i.BehaviorSubject(0),this._sizeChange=new i.BehaviorSubject([0,0]),this.ignoreScrollEvent=!1,this._initialScrollTop=-1,this.currentScrollState=c.IDLE,this._rowHeight=100,this._autoHeight=!1,this._heightAutoComputed=!1,this.scrollbarStyle="normal",this.scrollbarWidth=u()}return Object.defineProperty(t.prototype,"holderHeight",{get:function(){return this._holderHeight},set:function(t){var e=this;void 0!==t&&(this._holderHeight=t,0===this._holderHeight&&(this.listContainer.nativeElement.scrollTop=0),-1!==this._initialScrollTop&&0!==this._holderHeight&&setTimeout(function(){e.listContainer.nativeElement.scrollTop=e._initialScrollTop,e._initialScrollTop=-1}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"holderHeightInPx",{get:function(){return this.holderHeight?this.holderHeight+"px":"100%"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollStateChange",{get:function(){return this._scrollStateChange.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollPosition",{get:function(){return this._scrollPosition.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sizeChange",{get:function(){return this._sizeChange.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeight",{set:function(t){t!=undefined&&("auto"!=t?(this._rowHeight=Number(t),this._heightAutoComputed=this._autoHeight=!1):(this._heightAutoComputed=!1,this._autoHeight=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"newScrollPosition",{set:function(t){this.listContainer.nativeElement.scrollTop=t,this.holderHeight||(this._initialScrollTop=t),this._scrollPosition.next(t)},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){var e=this;"hide-scrollbar"===this.scrollbarStyle&&(this.listContainer.nativeElement.style.right=0-this.scrollbarWidth+"px",this.listContainer.nativeElement.style.paddingRight=this.scrollbarWidth+"px"),window&&this._subscription.add(i.fromEvent(window,"resize").subscribe(function(){e.requestMeasure()})),this._subscription.add(i.fromEvent(this.listContainer.nativeElement,"scroll").pipe(o.filter(function(){return!e.ignoreScrollEvent||(e.ignoreScrollEvent=!1)}),o.map(function(){return e.listContainer.nativeElement.scrollTop})).subscribe(function(t){e._scrollPosition.next(t)})),this._subscription.add(this.scrollPosition.pipe(o.tap(function(){e.currentScrollState===c.IDLE&&(e.currentScrollState=c.SCROLLING,e._scrollStateChange.next(e.currentScrollState))}),o.debounceTime(200)).subscribe(function(){e.currentScrollState===c.SCROLLING&&(e.currentScrollState=c.IDLE,e._scrollStateChange.next(e.currentScrollState))})),setTimeout(function(){e.requestMeasure()})},t.prototype.ngOnDestroy=function(){this._subscription.unsubscribe()},t.prototype.measure=function(){if(this.listContainer&&this.listContainer.nativeElement){var t=this.listContainer.nativeElement.getBoundingClientRect();return this._containerWidth=t.width-this.scrollbarWidth,this._containerHeight=t.height,{width:this._containerWidth,height:this._containerHeight}}return{width:0,height:0}},t.prototype.requestMeasure=function(){var t=this.measure(),e=t.width,i=t.height;this._sizeChange.next([e,i])},t.decorators=[{type:e.Component,args:[{selector:"gc-virtual-repeat-container",template:'<div class="gc-virtual-repeat-container" #listContainer [ngClass]="scrollbarStyle">\n    <div class="gc-virtual-repeat-container" [style.height]="holderHeightInPx">\n        <ng-content></ng-content>\n    </div>\n</div>\n',styles:[".gc-virtual-repeat-container{overflow-y:auto;overflow-x:hidden;position:relative;contain:layout;-webkit-overflow-scrolling:touch}.gc-virtual-repeat-container .gc-virtual-repeat-container-holder{width:100%;position:relative}.gc-virtual-repeat-container.normal{width:100%;height:100%}.gc-virtual-repeat-container.hide-scrollbar{position:absolute;top:0;left:0;bottom:0;right:0}"]}]}],t.ctorParameters=function(){return[]},t.propDecorators={listContainer:[{type:e.ViewChild,args:["listContainer"]}],scrollPosition:[{type:e.Output}],rowHeight:[{type:e.Input}],newScrollPosition:[{type:e.Input}]},t}(),c={SCROLLING:0,IDLE:1};function u(){var t=document.createElement("p");t.style.width="100%",t.style.height="200px";var e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",e.style.width="200px",e.style.height="150px",e.style.overflow="hidden",e.appendChild(t),document.body.appendChild(e);var i=t.offsetWidth;e.style.overflow="scroll";var r=t.offsetWidth;return i==r&&(r=e.clientWidth),document.body.removeChild(e),i-r}c[c.SCROLLING]="SCROLLING",c[c.IDLE]="IDLE";var h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};function p(t,e){function i(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var f=function(n){function t(t,e,i,r){return n.call(this,t,e,i,r)||this}return p(t,n),Object.defineProperty(t.prototype,"virtualRepeatForTrackBy",{get:function(){return this._trackByFn},set:function(t){e.isDevMode()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn("trackBy must be a function, but received "+JSON.stringify(t)+". See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"virtualRepeatForTemplate",{set:function(t){t&&(this._template=t)},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){if("virtualRepeatOf"in t){var e=t.virtualRepeatOf.currentValue;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this._trackByFn)}catch(i){throw new Error("Cannot find a differ supporting object '"+e+"' of type '"+g(e)+"'. NgFor only supports binding to Iterables such as Arrays.")}}},t.prototype.ngDoCheck=function(){if(this._differ){var t=this._differ.diff(this.virtualRepeatOf);t&&this.applyChanges(t)}},t.prototype.applyChanges=function(t){var r=this;this._collection||(this._collection=[]);var n=!1;t.forEachOperation(function(t,e,i){null==t.previousIndex?(n=!0,r._collection.splice(i,0,t.item)):null==i?(n=!0,r._collection.splice(e,1)):r._collection.splice(i,0,r._collection.splice(e,1)[0])}),t.forEachIdentityChange(function(t){r._collection[t.currentIndex]=t.item}),n&&this.requestMeasure(),this.requestLayout()},t.prototype.ngOnDestroy=function(){this._subscription.unsubscribe(),this._recycler.clean()},t.prototype.measure=function(){var t=this._collection&&0!==this._collection.length?this._collection.length:0;this._isInMeasure=!0,this._virtualRepeatContainer.holderHeight=this._virtualRepeatContainer._rowHeight*t,this.calculateScrapViewsLimit(),this._isInMeasure=!1,this._invalidate=!0,this.requestLayout()},t.prototype.layout=function(){if(!this._isInLayout){this._isInLayout=!0;var t=this._virtualRepeatContainer.measure(),e=t.width,i=t.height;if(this._containerWidth=e,this._containerHeight=i,!this._collection||0===this._collection.length){for(var r=0;r<this._viewContainerRef.length;r++){var n=this._viewContainerRef.get(r);this._viewContainerRef.detach(r),r--}return this._isInLayout=!1,void(this._invalidate=!1)}this.findPositionInRange(this._collection.length);for(r=0;r<this._viewContainerRef.length;r++){n=this._viewContainerRef.get(r);this._viewContainerRef.detach(r),this._recycler.recycleView(n.context.index,n),r--}this.insertViews(),this._recycler.pruneScrapViews(),this._isInLayout=!1,this._invalidate=!1}},t.prototype.insertViews=function(){if(0<this._viewContainerRef.length){for(var t=this._viewContainerRef.get(0),e=this._viewContainerRef.get(this._viewContainerRef.length-1),i=t.context.index-1;i>=this._firstItemPosition;i--){var r=this.getView(i);this.dispatchLayout(i,r,!0)}for(i=e.context.index+1;i<=this._lastItemPosition;i++){r=this.getView(i);this.dispatchLayout(i,r,!1)}}else for(i=this._firstItemPosition;i<=this._lastItemPosition;i++){r=this.getView(i);this.dispatchLayout(i,r,!1)}},t.prototype.getView=function(t){var e=this._recycler.getView(t),i=this._collection[t],r=this._collection.length;return e?(e.context.$implicit=i,e.context.index=t,e.context.count=r):e=this._template.createEmbeddedView(new a.VirtualRepeatRow(i,t,r)),e},t.decorators=[{type:e.Directive,args:[{selector:"[virtualRepeat]"}]}],t.ctorParameters=function(){return[{type:r.VirtualRepeatContainer},{type:e.IterableDiffers},{type:e.TemplateRef},{type:e.ViewContainerRef}]},t.propDecorators={virtualRepeatOf:[{type:e.Input}],virtualRepeatForTrackBy:[{type:e.Input}],virtualRepeatForTemplate:[{type:e.Input}]},t}(a.VirtualRepeatBase);function g(t){return t.name||typeof t}var d=function(n){function t(t,e,i,r){return n.call(this,t,e,i,r)||this}return p(t,n),Object.defineProperty(t.prototype,"virtualRepeatAsynchForTrackBy",{get:function(){return this._trackByFn},set:function(t){e.isDevMode()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn("trackBy must be a function, but received "+JSON.stringify(t)+". See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"virtualRepeatAsynchForTemplate",{set:function(t){t&&(this._template=t)},enumerable:!0,configurable:!0}),t.prototype.ngOnChanges=function(t){if("virtualRepeatAsynchOf"in t){var e=t.virtualRepeatAsynchOf.currentValue;this._collection=e,this._virtualRepeatContainer._heightAutoComputed=!1,this.requestMeasure()}},t.prototype.measure=function(){var e=this;this._collection&&(this._isInMeasure=!0,this._collection.getLength().pipe(o.first()).subscribe(function(t){e._virtualRepeatContainer.holderHeight=e._virtualRepeatContainer._rowHeight*t,e.calculateScrapViewsLimit(),e._isInMeasure=!1,e._invalidate=!0,e.requestLayout()}))},t.prototype.layout=function(){var r=this;if(!this._isInLayout){this._isInLayout=!0;var t=this._virtualRepeatContainer.measure(),e=t.width,i=t.height;if(this._containerWidth=e,this._containerHeight=i,!this._collection)return this.detachAllViews();this._collection.getLength().pipe(o.first()).subscribe(function(t){if(0==t)return r.detachAllViews();r.findPositionInRange(t);for(var e=0;e<r._viewContainerRef.length;e++){var i=r._viewContainerRef.get(e);r._viewContainerRef.detach(e),r._recycler.recycleView(i.context.index,i),e--}r.insertViews(t),r._recycler.pruneScrapViews(),r._isInLayout=!1,r._invalidate=!1})}},t.prototype.insertViews=function(t){var i=this;if(0<this._viewContainerRef.length){for(var e=this._viewContainerRef.get(0),r=this._viewContainerRef.get(this._viewContainerRef.length-1),n=function(e){o.getView(t,e).subscribe(function(t){i.dispatchLayout(e,t,!0)})},o=this,a=e.context.index-1;a>=this._firstItemPosition;a--)n(a);var s=function(e){l.getView(t,e).subscribe(function(t){i.dispatchLayout(e,t,!1)})},l=this;for(a=r.context.index+1;a<=this._lastItemPosition;a++)s(a)}else{var c=function(e){u.getView(t,e).subscribe(function(t){i.dispatchLayout(e,t,!1)})},u=this;for(a=this._firstItemPosition;a<=this._lastItemPosition;a++)c(a)}},t.prototype.getView=function(e,i){var r=this,n=this._recycler.getView(i);return this._collection.getItem(i).pipe(o.first(),o.map(function(t){return n?(n.context.$implicit=t,n.context.index=i,n.context.count=e):n=r._template.createEmbeddedView(new a.VirtualRepeatRow(t,i,e)),n}))},t.decorators=[{type:e.Directive,args:[{selector:"[virtualRepeatAsynch]"}]}],t.ctorParameters=function(){return[{type:l},{type:e.IterableDiffers},{type:e.TemplateRef},{type:e.ViewContainerRef}]},t.propDecorators={virtualRepeatAsynchOf:[{type:e.Input}],virtualRepeatAsynchForTrackBy:[{type:e.Input}],virtualRepeatAsynchForTemplate:[{type:e.Input}]},t}(a.VirtualRepeatBase),y=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[n.BrowserModule],declarations:[l,f,s.VirtualRepeatAsynch],exports:[l,f,s.VirtualRepeatAsynch]}]}],t}();t.SCROLL_STOP_TIME_THRESHOLD=200,t.VirtualRepeatContainer=l,t.SCROLL_STATE=c,t.getScrollBarWidth=u,t.VirtualRepeat=f,t.getTypeNameForDebugging=g,t.VirtualRepeatAsynch=d,t.VirtualRepeatAngularLibModule=y,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=virtual-repeat-angular-lib.umd.min.js.map